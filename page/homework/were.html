<!DOCTYPE html>
<html>
<head>
    <title>阅读</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <style type="text/css">

        .decorate{
            color: #008000;
            background-color: #fff;
            height: 24px;
            line-height: 24px;
            /*width: 90px;*/
            padding-left: 10px;
            padding-right: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            margin-left: 4px;
            display: inline-block;

        }
        
        .practice{
            margin-top: 24px;
        }
      

        .students{
            margin-top: 26px;
        }
        .subwere{
            margin-top: 40px;
            padding-left: 20px;
            padding-right: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            height: 70%;
        }
        .weretitle{
            line-height: 36px;
        }
        .weretitle>span{
            font-weight: 600;
            margin-right: 10px;
            font-size: 14px;
        }
        .practices{
            font-size: 18px!important;
        }
        .date{
            font-size: 16px!important;
        }
        .subline{
            line-height: 26px;
            font-size: 14px;
        }
        .question{
            color: rgb(0, 0, 255);
            font-weight: 600;
        }
        .stuquestion>span{
            margin-right: 6px;
        }
        .correct{
            color: rgb(0, 128, 0);
            font-weight: 600;
        }
        .stucorrect>span{
            margin-right: 6px;
        }
        .practice:after{
            content: "";
            display: block;
            clear: both;
        }
        .bg-line{
            bottom: 0px;
        }
        .practice {
            margin-top: 10px;
        }
        .practiceList p {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .prac>span {
            position: absolute;
            bottom: 0px;
            left: 3px;
            display: inline-block;
            width: 30px;
            line-height: 16px;
            border-radius: 4px;
            background-color: red;
            color: #fff;
            display: none;
        }
        .secs:after {
            content: "";
            display: block;
            clear: both;
        }
        .prac{
            position: relative;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <div class="logos lf">
                <img src="../../img/120.png">
                <span>启思教育</span>
            </div>
            <div class="con_title">英语阅读宝</div>
            <div class="operation rf">
                <div class="ope_first lf">
                    <img src="../../img/120.png">
                    <span>张三</span>
                    <img src="../../img/homework/u2104.png" class="tags">
                    <ul class="message_list">
                        <li>
                            <a href="#">基本资料</a>
                        </li>
                        <li>
                            <a href="#">安全设置</a>
                        </li>
                    </ul>
                </div>
                <div class="exit lf">
                    <a href="../../index.html">退出</a>
                </div>
            </div>
            <div class="leafbg">
                <img src="../../img/homework/u1884.gif">
            </div>
        </div>
        <div class="mainContent">

            
            <div class="cenContent">
                <div class="main">
                <!-- 左侧 -->
                <div class="mainleft">
                    <ul class="nav_list">
                        <li><a href="homework.html">布置作业</a> </li>
                        <li>
                            <a href="personal.html">个人作业</a>            
                        </li>
                        <li><a href="result.html">成绩统计</a></li>
                        <li><a href="read.html">阅卷</a></li>
                        <li class="navactive"><a href="were.html">错题库</a></li>
                        <li><a href="assessment.html">评估</a></li>
                        <li><a href="management.html">班级管理</a></li>
                    </ul>
                </div>
                <!-- 中间 -->
                <div class="maincenter">
                    
                    <div class="cen_content">
                        
                        
                        <div>
                            <div class="decorate">错题库</div>
                            
                        </div>
                        <!-- 改错 -->
                        <div class=" subwere">
                            <p class="weretitle">
                                <span class="practices"></span>
                                <span class="date"></span>
                            </p>
                            <div class="errorContents">
                                
                            </div>
                            
                       
                            
                        </div>
                      
                        
                        <!-- 左右翻页 -->
                        <div class="left_btn">
                            <img src="../../img/homework/u1878.gif">
                        </div>
                        <div class="right_btn">
                            <img src="../../img/homework/u1879.gif">
                        </div>
                    </div>
                </div>
                <!-- 右侧 -->
                <div class="mainright">
                    <div class="classes">
                        <div class="sec classSec">
                            
                         </div>
                        <div class="lastsec">
                            <div class="lf classLf"><</div>
                            <div class="lf classcount">1</div>
                            <div class="lf classRf">></div>
                        </div>
                    
                    </div>
                    <div class="classes practice">
                            
                        <div class="secs practiceList">
                            
                        </div>
                      
                        <div class=" lastsec">
                            <div class="lf pracLf"><</div>
                            <div class="lf pracCen">1</div>
                            <div class="lf pracRf">></div>
                        </div>
                    </div>
                    <!-- <div class="students">
                        
                        <div class="stusline">
                            
                        </div>
                        
                        <div class="laststusline">
                            <div class="stu stuleft lf bg2"><</div>
                            <div class="stu stucenter lf bg2">1</div>
                            <div class="stu sturight lf bg2">></div>
                        </div>
                    </div> -->
                </div>
            </div>
            </div>
            <div class="bg-line"></div>   
        </div>
    </div>
    <div class="layerMask"></div>
    <div class="loading">
        <div class="loadBox">
            <div class="spinner"></div>
        </div>
    </div>
    <script type="text/javascript" src="../../js/jquery.min.js"></script>

    <script type="text/javascript" src="../../js/request.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript">
        $(function () {
            //页面自适应
           $(window).resize(function () {  
                C.resezes();
            });
            C.resizes();
            
             var paramClass={
                "IndexPage": 1,
                "IndexSize":6
            }
             var param={
                'IndexPage':1,
                'IndexSize':9
            }
           if(localStorage.getItem('teacherNames')){
                $(".ope_first").find('span').text(localStorage.getItem('teacherNames'));
             }
            var paramList={};//错题哭信息
            var classListId=[],gradeid='',gradeName='';//班级id列表
            var classNum=0;
            paramClass.TeacherId=localStorage.getItem('TeacherIds');
             //获取班级列表
            getClassData();
            function getClassData(){
                console.log(paramClass);
                var classData=C.POST(paramClass,httpUrl.GetClassListByTeacherID,successGetclass);
                
                
            }
            function successGetclass(classData) {
                if(classData.Result==1){
                    $(".classcount").text(paramClass.IndexPage);
                    createClassList(classData.Data);
                    setClassCheck();
                    // param.ClassId=classData.Data[1].Id;
                    // param.ClassId='aaa';
                    paramList.ClassId='aaa';
                    // getdata();
                    // classCount=classData.count;
                    if(classData.Count%paramClass.IndexSize>0){
                        classCount=parseInt(classData.Count/paramClass.IndexSize)+1;
                    }else{
                        classCount=parseInt(classData.Count/paramClass.IndexSize);
                    }
                }else{
                    paramClass.IndexPage-=classNum;
                    C.layer(1,classData.Message);
                }
            }
            function createClassList(data){
                console.log(data);
                var list='';
                for(var i=0;i<data.length;i++){
                    if(param.ClassId==''){
                        // param.ClassId=data[i].Id;
                        param.ClassId='aaa';
                        getdata();
                    }
                    list+='<div id='+data[i].Id+' gradeid='+data[i].GradeId+' gradename='+data[i].GradeName+' class="lf classtable">'+data[i].Name+'<span>选中</span></div>'
                }
                $(".classSec").html(list);

            }
            
            $(".classLf").on("click",function(){
                if(paramClass.IndexPage>1){
                    classNum=-1;
                    paramClass.IndexPage+=classNum;
                    
                    getClassData();
                }else{
                    paramClass.IndexPage=1;
                    C.layer(2,"已经是第一页啦！");
                }
            });
            $(".classRf").on("click",function(){
                if(paramClass.IndexPage<classCount){
                    classNum=1;
                    paramClass.IndexPage+=classNum;
                    getClassData();

                }else{
                    paramClass.IndexPage=classCount;
                    C.layer(2,"已经是最后一页啦！");
                }
            });
            $(".classes").on("click",'.classtable',function(){
                $(this).find('span').toggle();
                //判断是否所有的班级选中全部清除
                var spanbox=$('.classes').find('span');
                // var boxBool=true;
                var spanBool=$(this).find('span').css("display");
                var spanId=$(this).attr('id');
                var grades=$(this).attr('gradeid');  
                
                if(spanBool=='block'){
                    if(gradeid==''){
                        gradeid = grades;
                        param.ClassId=spanId;
                        paramList.ClassId='aaa';
                        // getStudent();
                        getdata();
                        gradeName = $(this).attr('gradeName');
                        // return false; 
                    }else{
                        C.layer(2,"不能同时选择两个班级！");
                        $(this).find('span').hide();
                        return false;
                    }
                }else{
                    gradeid='';
                }
   
                if(spanBool=='block'){
                    classListId.push(spanId);
                }else{
                    var j=classListId.indexOf(spanId);
                    classListId.splice(j,1);
                }
                 // getdata();
            });
            //翻页后班级是否选中
            function setClassCheck(){
                console.log(classListId);
                if(classListId.length!=0){
                    var spanRember=$(".classtable");
                    for(var i=0;i<spanRember.length;i++){
                        var ids=spanRember[i].id;
                        if(classListId.indexOf(ids,0)!=-1){
                            $(spanRember).eq(i).find('span').show();
                        }else{
                            $(spanRember).eq(i).find('span').hide();//可以不要
                        }

                    }
                }
            }
            //获取任务列表
            var pracount=0,praNum=0;
           function getdata(){
                
                var resultData=C.POST(param,httpUrl.TeacherTaskPersonalListAll,successGetdata);
                
            }
            function successGetdata(resultData) {
                if(resultData.Result==1){
                    $('.pracCen').text(param.IndexPage);
                    if(resultData.Count%param.IndexSize>0){
                        pracount=parseInt(resultData.Count/param.IndexSize)+1;
                    }else{
                        pracount=parseInt(resultData.Count/param.IndexSize);
                    }
                    createPracList(resultData.Data);
                }else{
                    param.IndexPage-=praNum;
                    C.layer(2,resultData.Message);

                }
            }
            function createPracList(data){
                 var htmls='',nameArr=[];
                 for(var i=0;i<data.length;i++){
                    var times=String(data[i].createDate).slice(0,10);
                    if(data[i].Name.length>7){
                        nameArr=data[i].Name.split('-');
                    }else{
                        nameArr=[data[i].Name,data[i].Name];
                    }
                  
                    htmls+='<div class="lf bg1 prac" quesTime="'+data[i].DoQuestions+'" times="'+data[i].LimitedTime+'" names="'+data[i].Name+'"" id="'+data[i].Id+'"><p>'+nameArr[1]+'</p><p>'+nameArr[0]+'</p><p>'+i+'</p><span>选中</span></div>';
                 }
                $('.practiceList').html(htmls);
            }
       
            $('.practiceList').on('click','.prac',function(){
                $('.practiceList').find('span').hide();
                // paramList.classTaskId=$(this).attr('id');
                var name=$(this).attr('names');
                var createDate=$(this).attr("quesTime");
                $('.practices').text(name);
                $(".date").text(createDate);
                paramList.classTaskId='ea266f2a-94f0-41f5-b108-cdaf5ba6eee5';
                getTabledata();
                 $(this).find('span').show();
            });
            var praNum=0;
            $(".pracLf").on("click",function(){
                if(param.IndexPage>1){
                    praNum=-1;
                    param.IndexPage+=praNum;
                    
                    getdata();
                }else{
                    param.IndexPage=1;
                    C.layer(2,"已经是第一页啦！");
                    return false;
                }
            });
            $(".pracRf").on("click",function(){
                if(param.IndexPage<pracount){
                    praNum=1;
                    param.IndexPage+=praNum;
                    getdata();

                }else{
                    param.IndexPage=pracount;
                    C.layer(2,"已经是最后一页啦！");
                    return false;
                }
            });
            function getTabledata() {
                console.log(paramList);
                 var data=C.POST(paramList,'http://192.168.16.99:3246/api/TeacherTask/TeacherTaskErrorDetailList',successGetTable);
            }
            function successGetTable(data) {
                console.log(333333);
                var str='';
                var datas=data.Data;
                if(data.Result==1){
                    for(var i=0;i<datas.length;i++){
                        str+='<p class="weretitle"><span>章节名称：<span class="pianzhagn">'+datas[i].Name+'</span></span></p>';
                        var ques=datas[i].QuestionItem;
                        for(var j=0;j<ques.length;j++){
                            str+='<p class="question subline">'+(j+1)+'.答错学生</p><p class="stuquestion subline">';
                            if(ques.ErrorStudentName!=null){
                                $.each(ques[j].ErrorStudentName,function(val,index){
                                    str+='<span>'+val+'</span>'
                                });
                                
                            }
                  
                            str+='</p><p class="correct subline">订正学生</p><p class="stucorrect subline">';
                            if(ques.CorrectStudentName!=null){
                                $.each(ques[j].CorrectStudentName,function(val,index){
                                    str+='<span>'+val+'</span>'
                                });
                            }
                            str+='</p>'
                        }
                    }
                    console.log(str);
                    $('.errorContents').html(str);
                }
            }
            $(".ope_first").on({
                mouseover:function (e) {
                    e.stopPropagation();
                    $(".message_list").show();
                },
                mouseout:function (e) {
                    e.stopPropagation();
                    $(".message_list").hide();
                }
            });
        });
    </script>
</body>
</html>