<!DOCTYPE html>
<html>
<head>
    <title>教师布置作业-任务列表</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <style type="text/css">

        .decorate{
            /*position: absolute;*/
            color: #008000;
            background-color: #fff;
            height: 24px;
            line-height: 24px;
            width: 110px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            /*margin-top: 4px;*/
            margin-bottom: 4px;
            margin-left: 4px;
            display: inline-block;

        }
        .decorates{
            color: #008000;
            background-color: #fff;
            /*height: 20px;*/
            line-height: 20px;
            width: 110px;
            text-align: center;
            font-size: 14px;
            /*font-weight: 600;*/
            /*margin-top: 4px;*/
            margin-bottom: 4px;
            margin-left: 4px;
            display: inline-block;
        }
      
        .trline{
            line-height: 35px;
        }
        
        
        .serial{
           width: 20px;
           line-height: 20px;
           background-image: url(../../img/homework/u1888.png);
           background-repeat: no-repeat;
           background-size: 100% 100%;
           text-align: center;

        }
       
        
        .countcla{
            width: 100px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .cell1{
            width: 18%;
        }
        .cell2{
            width: 18%;
        }
        .cell3{
            width: 12%;
        }
        .cell4{
            width: 8%;
        }
        .cell5{
            width: 8%;
        }
        .cell6{
            width: 8%;
        }
        .cell7{
            width: 8%;
        }
        .cell8{
            width: 10%;
        }
        .cell9{
            width: 10%;
        }
        .allCount{
            position: absolute;
            bottom: -3.4%;
            right: 40%;
            width: 60px;
            text-align: center;
            line-height: 20px;
            color: #fff;
            background-color: rgba(98, 201, 210, 1);
            font-size: 12px;
            border-radius: 24px;
        }
        .bg-line{
            bottom: 0px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <div class="logos lf">
                <img src="../../img/120.gif">
                <span>启思教育</span>
            </div>
            <div class="homes" onclick="C.rotateImg()">
                <img class="" src="../../img/home.png">
            </div>
            <div class="con_title">英语阅读宝</div>
            <div class="operation rf">
                <div class="ope_first lf">
                    <img src="../../img/120.png">
                    <span>张三</span>
                    <!-- <img src="../../img/homework/u2104.png" class="tags"> -->
                    <ul class="message_list">
                        <li>
                            <a href="#">基本资料</a>
                        </li>
                        <li>
                            <a href="#">安全设置</a>
                        </li>
                        <li>
                            <a href="#">消息中心</a>
                        </li>
                    </ul>
                </div>
                <div class="exit lf">
                    <a href="../../index.html">退出</a>
                </div>
            </div>
            <div class="leafbg">
                <img src="../../img/homework/u1884.gif">
            </div>
        </div>
        <div class="mainContent">
            <div class="cenContent">
                <div class="main">
                    <div class="mainleft">
                        <ul class="nav_list">
                            <li class="navactive"><a href="homework.html">布置作业</a> </li>
                            <li>
                                <a href="personal.html">个人作业</a>            
                            </li>
                            <li><a href="result.html">成绩统计</a></li>
                            <li><a href="read.html">阅卷</a></li>
                            <li><a href="were.html">错题库</a></li>
                            <li><a href="assessment.html">评估</a></li>
                            <li><a href="management.html">班级管理</a></li>
                            <li><a href="../buy/buy.html">更多篇章</a></li>
                        </ul>
                    </div>
                    <div class="maincenter">
                        
                        <div class="cen_content">
                            <div class="task_list">返回布置任务</div>
                            
                            <div>
                                <!-- <div class="decorate">布置班级作业</div> -->
                                <div class="decorates">班级任务列表</div>
                            </div>
                             <!-- 表格 -->
                            <ul class="tablelist">
                                  
                            </ul>
                             <!-- 页码 -->
                             <div class="count">1</div>
                             <!-- 发布任务 -->
                             <!-- <div class="allCount"></div> -->
                            <!-- 左右翻页 -->
                            <div class="left_btn">
                                上一页
                                <!-- <img src="../../img/homework/u1878.gif"> -->
                            </div>
                            <div class="right_btn">
                                下一页
                                <!-- <img src="../../img/homework/u1879.gif"> -->
                            </div>
                        </div>
                    </div>
                    <div class="mainright">
                        <div class="seleclasses">
                            <p>选择班级</p>
                                <input type="text" class="selectNum" value="未选择">
                        </div>

                    </div>
                </div>
            </div>
            <div class="bg-line">
            </div>   
        </div>
    </div>
    <div class="mask">
       <div class="maskflex">
            <div class="lists">
                <span class="close_list">×</span>
                
                <ul class="classSec"></ul>
               
                <p class="mask_sure">确定</p>
            </div>
       </div>
    </div>
    <div id="pop-box"></div>
    <div class="layerMask"></div>

   <div class="loading">
        <div class="loadBox">
            <div class="spinner"></div>
            <p>加载中，请稍后。。。</p>
        </div>
   </div>
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/request.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
      <script type="text/javascript" src="../../js/subject.js"></script>
    <script type="text/javascript">
        $(function () {
            var param={
                'IndexPage':1,
                'IndexSize':10
            };
            var paramClass={
                "IndexPage": 1,
                "IndexSize":100
            }
            var Vparams={
                'IndexPage':1,
                'IndexSize':1
            };
            var VdetailParam={
                'IndexPage':1,
                'IndexSize':1
            }
            var classListId=[],gradeid='',gradeName='';//班级id列表
            var accountName=sessionStorage.getItem('accountName');
            paramClass.TeacherId=accountName;
            param.publisherId=localStorage.getItem('publisherId');
            var count='',classCount='';
            if(localStorage.getItem('teacherNames')){
                $(".ope_first").find('span').text(localStorage.getItem('teacherNames'));
             }
         
            $(".ope_first").on({
                mouseover:function (e) {
                    e.stopPropagation();
                    $(".message_list").show();
                },
                mouseout:function (e) {
                    e.stopPropagation();
                    $(".message_list").hide();
                }
            });
            
            getdata();
            function getdata(){
                
               C.POST(param,httpUrl.TeacherTaskListAll,successGetData);
                
            }
            function successGetData(tableData){
                $(".tablelist").empty();
                if(tableData.Result==1){
                    if(tableData.Count%param.IndexSize>0){
                        count=parseInt(tableData.Count/param.IndexSize)+1;
                    }else{
                        count=parseInt(tableData.Count/param.IndexSize);
                    }
                    $('.count').text(param.IndexPage);
                    createList(tableData.Data);
                    var countStr='共'+count+'页';
                    $(".allCount").html(countStr);
                }else{
                    C.layer(1,tableData.Message);
                }
            }
           
            function createList(data){
                var list='<li><p class="cell1">发布日期</p><p class="cell2">任务名称</p><p class="cell3">任务日期</p><p class="cell4">班级</p><p class="cell5">限时(分钟)</p><p class="cell6">单元</p><p class="cell7">学期</p><p class="cell8">详情</p><p class="cell9">操作</p></li>';
                for(var i=0;i<data.length;i++){
                    // data[i].CreateDate=data[i].CreateDate.slice(0,10);
                    data[i].DoQuestions=String(data[i].DoQuestions).substring(0,10);
                    var limitTime='';
                    if(data[i].LimitedTime!=null){
                        limitTime=data[i].LimitedTime;
                    }else{
                        limitTime='未限时'
                    }
                    if(i<data.length-1){
                        list+='<li class="trline"  style="border-bottom:1px solid #999">';
                    }else{
                        list+='<li class="trline">';
                    }
                    var createTime=data[i].CreateTime.split('T');
                    createTime[1]=createTime[1].slice(0,5);
                    list+='<p class="chapter cell1">'+createTime[0]+' '+createTime[1]+'</p>';
                    list+='<p class="cell2">'+data[i].Name+'</p>';
                    list+='<p class="cell3">'+data[i].DoQuestions+'</p>';
                    list+='<p class="cell4">'+data[i].ClassName+'</p>';
                    list+='<p class="cell5">'+limitTime+'</p>';
                    list+='<p class="cell6">'+data[i].Unit+'</p>';
                    // list+='<p class="cell7">'+data[i].writingSkillId+'</p>';
                    // list+='<p class="cell8">'+data[i].words+'</p>';
                    list+='<p class="cell7">'+data[i].Term+'</p>';
                    list+='<p class="cell8"><span class="preview dbtn" data-id="' + data[i].Id + '">查看</span></p>';
                    list+='<p class="cell9"><span class="view dbtn"  data-id="' + data[i].Id + '" >删除</span></p>';
                    list+='</li>';
                }
                $(".tablelist").html(list);
            }
            // 左翻页
            var tablenum=0;
            $(".left_btn").on("click",function(){
                if(param.IndexPage>1){
                    
                    tablenum=-1;
                    param.IndexPage+=tablenum;
                    getdata();
                }else{
                    param.IndexPage=1;
                    C.layer(2,"已经是第一页啦！");
                }
            });
            $(".right_btn").on("click",function(){
                if(param.IndexPage<count){
                   tablenum=1;
                   param.IndexPage+=tablenum;
                    getdata();

                }else{
                    param.IndexPage=count;
                    
                    C.layer(2,"已经是最后一页啦！");
                }
            });
            //获取班级列表
            $('.seleclasses').on('click',function(){
                $(".mask").show();
                $(".classSec").show();
            });
            $(".classSec").on("click",function(e){
                e.stopPropagation();
            });
            $(".mask,.close_list,.mask_sure").on("click",function(){
                $('.mask').hide();
                $('.mask').find("ul").hide();

            });
            $('.classSec').on('click','input',function(){
         
                var spanId=$(this).attr('id');
             
                param.ClassId=spanId;
                 paramClass.Id=spanId;
                var classname=$(this).attr('dataName');
                $('.selectNum').val(classname);
                getdata();
               
            });
            getClassData();
            function getClassData(){
                var classData=C.POST(paramClass,httpUrl.GetClassListByTeacherID,successGetclass);
            }
            function successGetclass(classData){
                if(classData.Result==1){
                    createClassList(classData.Data);
                }else{
                    C.layer(1,classData.Message);
                }
            }
            function createClassList(data){
                var list='';
                for(var i=0;i<data.length;i++){
                    if(data[i].IsAfterSchool){
                        xiaowai="(校外)";
                    }else{
                        xiaowai="";
                    }
                    list+='<li><input type="radio" id='+data[i].Id+' name="seleclasses" gradeid='+data[i].GradeId+' dataName='+data[i].Name+'><span>'+data[i].Name+xiaowai+'</span></li>'
                }
                $(".classSec").html(list);
            }
            //页面自适应
            $(window).resize(function () {  
                C.resezes();
            });
            C.resezes(1);
            //删除
            var deleteJson={};
            $('.tablelist').on('click','.view',function(){
                deleteJson.classTaskId=$(this).attr('data-id');
                C.POST(deleteJson,httpUrl.DelClassTask,deleteAjax);
            });
            function deleteAjax(datas){
                var data=datas.Data;
                if(data.Result==1){
                    C.layer(1,'删除成功');
                }
            }
            // 查看
            var str='',lens=0,countData=0;
            $(".tablelist").on("click",".preview",function(){
                countData=0;
                str='';
                Vparams.Id=$(this).attr('data-id');
                ajaxView();
            });
            function ajaxView(){
                 var ajaxViewData=C.POST(Vparams,httpUrl.GetClassTaskQuestion,ajaxViewDatas);
            }
            function ajaxViewDatas(ajaxViewData){
                console.log(ajaxViewData);
                if(ajaxViewData.Result==1){
                    var datalist=ajaxViewData.Data;
                    if(datalist!=null){
                        lens=datalist.length;
                        for(var i=0;i<lens;i++){
                            VdetailParam.Id=datalist[i].QuestionId;
                            getArticleDetail();
                        }
                    }else{
                        C.layer(2,'没有更多数据');
                    }
                }else{
                    C.layer(1,ajaxViewData.Message);
                }
            }
            function getArticleDetail(){
                C.POSTS(JSON.stringify(VdetailParam),httpUrl.GetEnglishArticleWithQuestion,PreviewSubject);
            }
            //题目预览
            function PreviewSubject(datas) {
               countData++;
                console.log(datas)
                var data=datas.Data;
                str += TeacherSubjectStrings(data);
                if(lens==countData){
                    openPopWin('checkDetail', str);
                }
                
            }
            //弹出层预览
             function openPopWin(type, content) { //根据传递进来的值，更改str内容

                var pop = document.querySelector("#pop-box");
                var str = "";
                // if (type == "checkDetail") {
                    str = '<div class="pop-win pop-content">\
                        <header class="close-btn-box"></header>\
                        <div class="pop-scroll">\
                            <div class="pop-content">';
                    str += content;
                    str += '</div>\
                        </div>\
                    </div>';
                pop.innerHTML = str;
                // $("#pop-box").html(str);
                var box = document.querySelector(".close-btn-box");
                var btn = document.createElement("span");
                var _this = this;
                btn.className = "close-btn";
                btn.addEventListener("click", function () {
                    $(pop).find(".pop-content").hide("slow", function () {
                        pop.innerHTML = "";
                    });
                });
                box.appendChild(btn);
                // $(".close-btn-box").append(btn);
            }
           
            $(".task_list").on("click",function(){
                window.history.go(-1);
            });
        });
    </script>
</body>
</html>