<!DOCTYPE html>
<html>
<head>
    <title>作业练习</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="../../css/common.css">
    <style type="text/css">

        .decorate{
            color: #008000;
            background-color: #fff;
            height: 24px;
            line-height: 24px;
            /*width: 90px;*/
            padding-left: 10px;
            padding-right: 10px;
            text-align: center;
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 4px;
            margin-left: 4px;
            display: inline-block;

        }
        
        .decorate_detail{
           
            line-height: 20px;
          
            text-align: center;
            font-size: 12px;
            padding-left: 6px;
            padding-right: 6px;
            margin-bottom: 4px;
            margin-left: 4px;
            display: inline-block;
        }
        .de_detail{
            /*width: 110px!important;*/
        }
        .practice{
            margin-top: 10px;
        }
        .bg1{
            /*background-color: rgba(0, 128, 0, 1)!important;*/
        }
        .bg2{
            /*background-color: rgba(0, 102, 255, 1)!important;*/
        }
        .bg3{
            background-color: rgba(111, 176, 81, 1);
        }
        .textlf,.textrf{
            width: 50%;
            height: 500px;
            margin-top: 50px;
            padding-left: 40px;
            padding-right: 40px;
            box-sizing: border-box;
        }
     
        .secs>.sbg{
            width: 50%;
            color: #fff;
            line-height: 57px;
        }
        .secs>.sbg:first-child{
            background-color: rgba(51, 204, 102, 1);
        }
        .secs>.sbg:last-child{
            background-color: rgba(0, 153, 255, 1);
        }
        .pracActive{
            background-color: rgba(0, 128, 0, 1)!important;
        }
        .pracActives{
            background-color: rgba(0, 102, 255, 1)!important;
        }
        .reload{
            position: absolute;
            width: 60px;
            text-align: center;
            line-height: 30px;
            border-radius: 3px;
            background-color: rgba(98, 201, 210, 1);
            color: #fff;
            right: 0px;
            top: -30px;
        }
        .time{
            color: red;
            font-size: 14px;
            font-weight: 600;
            float: right;
        }
        .mainContainer{
            margin-top: 34px;
            padding: 10px 20px;
            box-sizing: border-box;
            overflow-y: auto;
            height: 78%;
        }
        .mainTitle{
            font-size: 16px;
            font-weight: 600;
        }
        .allcount{
            position: absolute;
            bottom: -3.4%;
            right: 40%;
            width: 60px;
            text-align: center;
            line-height: 20px;
            color: #fff;
            background-color: rgba(98, 201, 210, 1);
            font-size: 12px;
            border-radius: 24px;
        }
        .secs:after{
            content: "";
            display: block;
            clear: both;
        }
        .practiceList p{
            overflow: hidden;    
            text-overflow:ellipsis;    
            white-space: nowrap;
        }
        .prac{
            position: relative;
        }
        .prac>span{
            position: absolute;
            bottom: 0px;
            left: 3px;
            display: inline-block;
            width: 30px;
            line-height: 16px;
            border-radius: 4px;
            background-color: red;
            color: #fff;
            display: none;
        }
      /*  .cenContent{
            bottom: 0px;
        }*/
        .main{
            height: 570px;
        }
        .bg-line{
            bottom: 0px;
        }
        .isReset{
            transform:scale(0.8);
            -ms-transform:scale(0.8);
            -moz-transform:scale(0.8);
            -webkit-transform:scale(0.8);
            -o-transform:scale(0.8);
            display: block!important;
            width: 45px!important;
            left: 0px!important;
        }
        .mainContainer{
            font-size: 18px;
        }

        .xuanzhong{
            position: absolute;
            top: 0px;
            left: 0px;
            height: 16px;
        }
        .pracBg1{
            background-color: rgba(0, 128, 0, 1)!important;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="nav">
            <div class="logos lf">
                <img src="../../img/120.gif">
                <span>启思教育</span>
            </div>
            <div class="homes" onclick="C.rotateImg()">
                <img class="" src="../../img/home.png">
            </div>
            <div class="con_title">英语阅读宝</div>
            <div class="operation rf">
                <div class="ope_first lf">
                    <img src="../../img/120.png">
                    <span class="names"></span>
                    <img src="../../img/homework/u2104.png" class="tags">
                    <ul class="message_list">
                        <li>
                            <a href="#">基本资料</a>
                        </li>
                        <li>
                            <a href="#">安全设置</a>
                        </li>
                    </ul>
                </div>
                <div class="exit lf">
                    <a href="../../index.html">退出</a>
                </div>
            </div>
            <div class="leafbg">
                <img src="../../img/homework/u1884.gif">
            </div>
        </div>
        <div class="mainContent">
            <div class="cenContent">
                <div class="main">
                    <div class="mainleft">
                        <ul class="nav_list">
                            <li><a href="practice.html">作业练习</a> </li>
                            <li>
                                <a href="statistical.html">成绩统计</a>            
                            </li>
                            <li class="navactive"><a href="errorCollection.html">错题库</a></li>
                           
                            <li><a href="assessment.html">评估</a></li>
                            <li><a href="ranking.html">排行榜</a></li>
                        </ul>
                    </div>
                    <div class="maincenter">
                        
                        <div class="cen_content">
                            
                            <div class="reload">提交订正</div>
                           
                            <div>
                                <div class="decorate">错题库</div>
                                
                            </div>
                            <!-- 作业 -->
                            <div class="mainContainer" id="ArticleContent">
                              
                            </div>
                           
                            
                            <!-- 左右翻页 -->
                            <div class="left_btn">
                                <img src="../../img/homework/u1878.gif">
                            </div>
                            <div class="right_btn">
                                <img src="../../img/homework/u1879.gif">
                            </div>
                        </div>
                    </div>
                    <div class="mainright">
                        <div class="classes">
                            <div class="sec classSec">
                                
                             </div>
                            <div class="lastsec">
                                <div class="lf classLf"><</div>
                                <div class="lf classcount">1</div>
                                <div class="lf classRf">></div>
                            </div>
                        
                        </div>
                        <div class="classes practice">
                            <div class="secs">
                                <div class="lf sbg personprac">班级练习</div>
                                <div class="lf sbg classprac">个人练习</div>
                            </div>
                            <div class="secs practiceList">
                                
                            </div>
                          
                            <div class=" lastsec">
                                <div class="lf pracLf"><</div>
                                <div class="lf pracCen">1</div>
                                <div class="lf pracRf">></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-line">
                <a href="../buy/buy.html"><img src="../../img/buy.png"></a>
            </div>
        </div>
    </div>
    <div class="layerMask"></div>
    <div class="loading">
        <div class="loadBox">
            <div class="spinner"></div>
        </div>
    </div>
     <!-- <div id="pop-box"></div> -->
    <script type="text/javascript" src="../../js/jquery.min.js"></script>
    <script type="text/javascript" src="../../js/subject.js"></script>
    <script type="text/javascript" src="../../js/common.js"></script>
    <script type="text/javascript" src="../../js/request.js"></script>

    <script type="text/javascript">
        $(function () {
            var paramClass={
                "IndexPage": 1,
                "IndexSize":6
            }
            var paramList={
                "IndexPage": 1,
                "IndexSize":9

            }
            var Tarsk={
                // "IndexPage": 1,
                // "IndexSize":1
            }
             var Vparams={
                'IndexPage':1,
                'IndexSize':1
            };
            var nums=1;
           var classNum=0,praNum=0;
             var classListId=[],gradeid='',gradeName='';//班级id列表
             var count="";
            var stuData=C.POST('',httpUrl.GetStudentInfo,successGetstu);
            //学生答案
            var stuSubQueList = {};
            console.log(stuData);
            if(localStorage.getItem('studentName')){
                $('.names').text(localStorage.getItem('studentName'));
            }
            function successGetstu(stuData){
                if(stuData.Result==1){
                    // paramClass.TeacherId=localStorage.getItem('TeacherIds');
                    // paramClass.studentId =stuData.data.id;
                    localStorage.setItem('studentId','s004');
                    paramClass.studentId ='s004';
                    paramList.studentId ='s004';
                     // paramList.schoolId=stuData.data.schoolId;
                     // answer.schoolId=stuData.data.schoolId;
                     // answer.studentId ='s004';
                    getClassData();
                }else{
                    C.layer(1,stuData.Message);
                }
            }
            //获取班级信息
            var classCount=0;
            function getClassData(){
                var classData=C.POSTS(JSON.stringify(paramClass),httpUrl.GetPageClassStudent,successGetclass);
            }
            function successGetclass(classData){

                if(classData.Result==1){
                    $(".classcount").text(paramClass.IndexPage);
                    createClassList(classData.Data);
                    setClassCheck();
                    paramList.ClassId=classData.Data[0].ClassId;
                   
                   if(classData.Count%paramClass.IndexSize>0){
                        classCount=parseInt(classData.Count/paramClass.IndexSize)+1;
                    }else{
                        classCount=parseInt(classData.Count/paramClass.IndexSize);
                    }
                    getpracData();
                }else{
                    paramClass.IndexPage-=classNum;
                    C.layer(1,classData.Message);
                }
            }
            function createClassList(data){
                console.log(data);
                var list='';
                for(var i=0;i<data.length;i++){
                    list+='<div id='+data[i].ClassId+' Gradeid='+data[i].GradeId+' gradename='+data[i].GradeName+' class="lf classtable">'+data[i].ClassesName+'<span>选中</span></div>'
                }
                $(".classSec").html(list);

            }
          
            $(".classLf").on("click",function(){
                C.leftPage(paramClass,classNum,getClassData);
            
            });
            $(".classRf").on("click",function(){
                C.rightPage(paramClass,classNum,classCount,getClassData);
          
            });
             //选中班级id
           
             $(".classes").on("click",'.classtable',function(){
                $('.classes').find('span').hide();
                //判断是否所有的班级选中全部清除
                var spanId=$(this).attr('id');
                var grades=$(this).attr('gradeid');  
               
                gradeid = spanId; 
                paramList.ClassId=spanId;
                // answer.classesId=spanId;
                paramList.IndexPage=1;
                getpracData();
                // gradeName = $(this).attr('gradeName'); 
                 $(this).find('span').show();
            });
            //翻页后班级是否选中
            function setClassCheck(){
                
                var ids=$(".classes").find('.classtable');
                for(var i=0;i<ids.length;i++){
                    var ID=$(ids).eq(i).attr('id');
                    if(gradeid==ID){
                        $(".classes").find('.classtable').eq(i).find('span').show();
                    }
                }
            }

            //获取练习列表
            var pracIdList=[],pracCount='',pracId='';
            var personClassBool=true;
            $(".personprac").on('click',function(){
                personClassBool=true;
                paramList.IndexPage=1;
                getpracData();
            });
            $(".classprac").on("click",function(){
                personClassBool=false;
                paramList.IndexPage=1;
                getpracData();
            });
            function getpracData(){
                 var pracListData={};
                 console.log(paramList);
                 console.log(personClassBool);
                if(personClassBool){
                    paramList.tarskType=0;
                }else{
                    paramList.tarskType=1;
                }
                pracListData=C.POSTS(JSON.stringify(paramList),httpUrl.GetPageEnglishArticleTaskWrongBase,successGetpra);
                
            }
            function successGetpra(pracListData){
                $('.practiceList').empty();
                if(pracListData.Result==1){
                    $(".pracCen").text(paramList.IndexPage);
                      createPracList(pracListData.Data);
                      setPracCheck();
                      var allpracCount=pracListData.Data[0].COUNTS;
                    if(allpracCount%paramList.IndexSize>0){
                        pracCount=parseInt(allpracCount/paramList.IndexSize)+1;
                    }else{
                        pracCount=parseInt(allpracCount/paramList.IndexSize);
                    }
                    console.log(pracListData.Data);
                   
                    
                }else{
                    paramList.IndexPage-=praNum;
                    C.layer(1,pracListData.Message);
                }
            }
            function createPracList(data){
                 var htmls='',nameArr=[];
                 for(var i=0;i<data.length;i++){
                    var times=String(data[i].CreateDate).slice(0,10);
                    if(data[i].Name.length>7){
                        nameArr=data[i].Name.split('-');
                    }else{
                        nameArr=[data[i].Name,data[i].Name];
                    }
                  
                    htmls+='<div class="lf  prac" times="'+data[i].LimitedTime+'" names="'+data[i].Name+'"" id="'+data[i].Id+'"><p>'+nameArr[1]+'</p><p>'+nameArr[0]+'</p><p>'+i+'</p>';
                    console.log();
                    htmls+=data[i].IsCorrection==1?'<span class="isReset">已订正</span></div>':'</div>';
                 }
                $('.practiceList').html(htmls);
            }
           
            $('.practiceList').on('click','.prac',function(){
           
                 C.load(0);
                $('.practiceList').find('.prac').removeClass('pracBg1');
                pracId=$(this).attr('id');
                Tarsk.EnglishArticleTaskWrongBaseId=pracId;
                nums=1;
                $(this).addClass('pracBg1');
                getWrongData();

            });
            
            //翻页后练习任务是否选中
            function setPracCheck(){
                console.log(pracIdList);
                var idRember=$(".prac");
                for(var i=0;i<idRember.length;i++){
            
                    if($(idRember).eq(i).attr('id')==pracId){
                        $(".prac").eq(i).addClass('pracBg1');
                    }

                }
            }
            //翻页
            $(".pracLf").on("click",function(){
                C.leftPage(paramList,praNum,getpracData);
           
            });
            
            $(".pracRf").on("click",function(){
                C.rightPage(paramList,praNum,pracCount,getpracData);
          
            });
            //获取错题
            var wrongNum=0,subjectArray={};
            function getWrongData(){
                var errorData=C.POSTS(JSON.stringify(Tarsk),httpUrl.GetEnglishArticleTaskWrongBaseList,successGetwrong);
                
            }
            function successGetwrong(data){
                if(data.Result==1){
                    wrongNum=data.Data.length;
                    subjectArray=data.Data;
                    resetItem();
                    //写作技巧
                    // if (subjectArray[subjectIndex].writingSkillId != "") {
                    //     var WritingQuestions = subjectArray[subjectIndex].WritingSkillDetail.WritingSkillItemList;
                    //     $.each(WritingQuestions, function (index, value) {
                    //         var inputDom = $('.' + value.Id);
                    //         if (value.WritingSkillItemAnswer.indexOf('|') != -1) {
                    //             if (stuSubQueList[value.Id] != undefined) {
                    //                 var itemAnsweArry = stuSubQueList[value.Id].split('|');
                    //                 $.each(inputDom, function (ind, val) {
                    //                     val.value = itemAnsweArry[ind];
                    //                 });
                    //             }
                    //         } else {
                    //             $.each(inputDom, function (ind, val) {
                    //                 if (val.type == "text") {
                    //                     val.value = stuSubQueList[value.Id] == undefined ? "" : stuSubQueList[value.Id];
                    //                 } else if (val.type == "radio") {
                    //                     if (val.value == stuSubQueList[value.Id]) {
                    //                         val.checked = true;
                    //                     }
                    //                 } else if (val.type == "textarea") {
                    //                     val.innerText = stuSubQueList[value.Id] == undefined ? "" : stuSubQueList[value.Id];
                    //                 }
                    //             });
                    //         }
                    //     });
                    // }
                    C.load(1);
                }else{
                    C.load(0);
                    C.layer(1,data.message);
                }
            }
            // function createList(){
            //     var subjectIndex = parseInt(nums)-1;
            //     var subStr = SubjectStringCorrect(subjectArray[subjectIndex]);
            //     // console.log(subStr);
            //     $('#ArticleContent').html(subStr);
            //      //题目
            //     // var questions = subjectArray[subjectIndex].englishArticleQuestionItem;
            //     // $.each(questions, function (index, value) {
            //     //     var inputDom = $('.' + value.id);
            //     //     if (value.answer.indexOf('|') != -1) {
            //     //         if (stuSubQueList[value.id] != undefined) {
            //     //             var itemAnsweArry = stuSubQueList[value.id].split('|');
            //     //             $.each(inputDom, function (ind, val) {
            //     //                 val.value = itemAnsweArry[ind];
            //     //             });
            //     //         }
            //     //     } else {
            //     //         $.each(inputDom, function (ind, val) {
            //     //             if (val.type == "text") {
            //     //                 val.value = stuSubQueList[value.id] == undefined ? "" : stuSubQueList[value.id];
            //     //             } else if (val.type == "radio") {
            //     //                 if (val.value == stuSubQueList[value.id]) {
            //     //                     val.checked = true;
            //     //                 }
            //     //             }
            //     //         });
            //     //     }
            //     // });
            // }
            $('.left_btn').on('click',function(){
                if(nums==1){
                   C.layer(2,'这已经是第一页啦！');
                }else if(nums>1){
                    // titleTime();
                    nums--;
                    // createList();
                    resetItem();
                    
                    // getresult();
                 
                }
            });
            $(".right_btn").on('click',function(){
                // console.log(nums,pracCount);
                if(nums>=wrongNum){
                    // getresult();
                    C.layer(2,"这是最后一页啦！")
                }else if(nums<wrongNum){
                    // titleTime();
                    nums++;
                    // createList();
                    resetItem();
                    
                    // getresult();

                }
            });
            // function successGetwrong(errorData){
            //     if(errorData.result==1){
            //         C.load(1);
            //         var result=errorData.data;
            //         var str = '';
            //         $.each(result, function (index, value) {
            //             str += SubjectStringWrong(value);
            //             str+='<br/>'
            //         });
                    
            //         $('#ArticleContent').html(str);
            //         //还原学生答案
            //         for (var i = 0; i < result.length; i++) {
            //             //题目
            //             var questions = result[i].englishArticleQuestionItem;
            //             $.each(questions, function (index, value) {
            //                 var inputDom = $('.' + value.id);
            //                 if (value.answer.indexOf('|') != -1) {
            //                     if (value.studentAnswer != undefined) {
            //                         var itemAnsweArry = value.studentAnswer.split('|');
            //                         $.each(inputDom, function (ind, val) {
            //                             val.value = itemAnsweArry[ind];
            //                         });
            //                     }
            //                 } else {
            //                     $.each(inputDom, function (ind, val) {
            //                         if (val.type == "text") {
            //                             val.value = value.studentAnswer == undefined ? "" : value.studentAnswer;
            //                         } else if (val.type == "radio") {
            //                             if (val.value == value.studentAnswer) {
            //                                 val.checked = true;
            //                             }
            //                         }
            //                     });
            //                 }
            //             });
            //             //写作技巧
            //             if (result[i].WritingSkillId != "" && result[i].WritingSkillId != null) {
            //                 var WritingQuestions = result[i].WritingSkillDetail.WritingSkillItemList;
            //                 $.each(WritingQuestions, function (index, value) {
            //                     var inputDom = $('.' + value.Id);
            //                     if (value.WritingSkillItemAnswer.indexOf('|') != -1) {
            //                         if (value.WritingSkillItemStuAnswer != undefined) {
            //                             var itemAnsweArry = value.WritingSkillItemStuAnswer.split('|');
            //                             $.each(inputDom, function (ind, val) {
            //                                 val.value = itemAnsweArry[ind];
            //                             });
            //                         }
            //                     } else {
            //                         $.each(inputDom, function (ind, val) {
            //                             if (val.type == "text") {
            //                                 val.value = value.WritingSkillItemStuAnswer == undefined ? "" : value.WritingSkillItemStuAnswer;
            //                             } else if (val.type == "radio") {
            //                                 if (val.value == value.WritingSkillItemStuAnswer) {
            //                                     val.checked = true;
            //                                 }
            //                             } else if (val.type == "textarea") {
            //                                 val.innerText = value.WritingSkillItemStuAnswer == undefined ? "" : value.WritingSkillItemStuAnswer;
            //                             }
            //                         });
            //                     }
            //                 });
            //             }
            //         }
            //         //还原学生答案
            //         autoLength();
            //         $('.article2 .article-scroll').scrollTop('0');
            //         $('.slimScrollBar').css('top', "0");
            //     }else{
            //         C.load(1);
            //         C.layer(1,errorData.data);
            //     }
            // }
            //订正错题
            var reload={},stuSubQueList={};
            function resetItem(){
                var stuSubQueListTemp = {};
                var subjectIndex = parseInt(nums)-1;
                $.each($("#form1").serializeArray(), function (i, v) {
                    // console.log(v);
                   
                    if (stuSubQueListTemp[v.name] != undefined) {
                        stuSubQueListTemp[v.name] += '|' + v.value.trim();
                    } else {
                        stuSubQueListTemp[v.name] = v.value.trim();
                    }
                });
                $.each(stuSubQueListTemp, function (index, value) {
                    stuSubQueList[index] = value;
                });
                console.log(stuSubQueList);
                var subStr = SubjectStringCorrect(subjectArray[subjectIndex]);
                // console.log(subStr);
                $('#ArticleContent').html(subStr);
                // console.log(subjectIndex);

                var questions = subjectArray[subjectIndex].EnglishArticleQuestionItem;
                // console.log(subjectArray[subjectIndex]);
                // for (var i = 0; i < subjectArray.length; i++) {
                    //题目
                var questions = subjectArray[subjectIndex].EnglishArticleQuestionItem;
                $.each(questions, function (index, value) {
                    var inputDom = $("."+value.Id);
                    console.log(inputDom);
                    if (value.Answer.indexOf('|') != -1) {
                        if (stuSubQueList[value.Id] != undefined) {
                            var itemAnsweArry = stuSubQueList[value.Id].split('|');
                            $.each(inputDom, function (ind, val) {
                                val.value = itemAnsweArry[ind];
                            });
                        }
                    } else {
                        console.log(inputDom);
                        $.each(inputDom, function (ind, val) {
                            console.log(val.value , stuSubQueList[value.Id]);
                            if (val.type == "text") {
                                val.value = stuSubQueList[value.Id] == undefined ? "" : stuSubQueList[value.Id];
                            } else if (val.type == "radio") {
                                if (val.value == stuSubQueList[value.Id]) {
                                    val.checked = true;
                                }
                            }
                        });
                    }
                });
                   
                console.log(stuSubQueList);
                
            }
            $('.reload').on('click',function(){
                C.load(0);
                resetItem();
                var str=JSON.stringify(stuSubQueList);
                console.log(str)
                str=str.replace(/"/g,"'");
                reload.studnetAnswer=str.slice(0,str.length);
                // reload.studnetAnswer = stuSubQueListTemp;
                var data=C.POSTS(JSON.stringify(reload),'http://192.168.16.99:10012/api/EnglishArticleTaskWrongBase/EditEditEnglishArticleTaskHistoryBase',successReload);
            });
            function successReload(data){
                if(data.result==1){
                    C.load(1);
                    C.layer(3,data.message);  
                    location.reload();                  
                }else{
                    C.load(1);
                    C.layer(1,data.message);
                }
            }
            $(window).resize(function () {  
                
                C.resezes();
            });
            C.resezes(1);
            $(".ope_first").on({
                mouseover:function (e) {
                    e.stopPropagation();
                    $(".message_list").show();
                },
                mouseout:function (e) {
                    e.stopPropagation();
                    $(".message_list").hide();
                }
            });
        });
    </script>
</body>
</html>